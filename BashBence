#!/bin/bash

inputOne="prop/questions.txt"
inputTwo="prop/answers.txt"
inputThree="prop/answerCount.txt"

echo "Udvozollek a Kviz programomban! Mit szeretnel csinalni?"
echo "1. Elkezdeni a jatekot"
echo "2. Kerdesek listajat megnezni"
echo "3. Kilepes"
read chosenMenu

goodAnswers=0
wrongAnswers=0

questionCount=$(head -n 1 $inputThree)
if (( $questionCount<0 )); then
	sed -i "1d" $inputThree
	echo "0" >> $inputThree
fi

while [ $chosenMenu != 1 ] && [ $chosenMenu != 2 ] && [ $chosenMenu != 3 ]
do
	echo "Rosszul adtad meg a szamot! Ujra!"
	read chosenMenu
done

if [ $chosenMenu == 1 ]
then
	questionCount=$(head -n 1 $inputThree)
	if (( $questionCount > 0 )); then
		echo "$questionCount kerdest kell helyesen megvalaszolnod. Sok sikert!"
		declare -a answeredQuestions
		for (( i=1; i<=$questionCount; i++ ))
		do
			questionAlreadyAsked=0
			questionNumber=$(( ( RANDOM % $questionCount )  + 1 ))
			while [ "$questionAlreadyAsked" -eq 0 ]
			do
				questionAlreadyAsked=1
				questionNumber=$(( ( RANDOM % $questionCount )  + 1 ))
				for (( j=0; j<i-1; j++ ))
				do
					if [ "${answeredQuestions[j]}" == "$questionNumber" ]; then
						questionAlreadyAsked=0
					fi
				done
			done
			answeredQuestions+=($questionNumber)
			echo "A(z) $i -ik kerdes: "
			sed -n "$questionNumber p" $inputOne
			answer=$(sed -n "$questionNumber p" $inputTwo)
			read valasz
			if [ "$answer" == "$valasz" ]; then
				echo "Helyes valasz!"
				goodAnswers=$(($goodAnswers+1))
			else
				echo "Helytelen valasz!!!"
				wrongAnswers=$(($wrongAnswers+1))
			fi
		done
		echo "Gratulalok! On vegigment a kerdeseken!"
		echo "A helyes valaszok szama: $goodAnswers"
		echo "A helytelen valaszok szama: $wrongAnswers"
		echo "Az eredmeny szazalekban: $(($goodAnswers*100/$questionCount))%"
		exit 0
	else
		echo "Nincsenek kerdesek hozzaadva, a hozzaadashoz kerem inditsa ujra a programot es valassza a 2-es opciot!"
		exit 0
	fi


elif [ $chosenMenu == 2 ]
then
	lineNumber=1
	while IFS= read -r line; do
		echo "$lineNumber : $line"
		lineNumber=$((lineNumber+1))
	done < "$inputOne"
	echo "Mit szeretne tenni?"
	echo "1. Kerdes hozzaadasa"
	echo "2. Kerdes torlese"
	echo "3. Osszes kerdes torlese"
	echo "4. Kilepes"
	read chosenMenuTwo
	while [ $chosenMenuTwo != 1 ] && [ $chosenMenuTwo != 2 ] && [ $chosenMenuTwo != 3 ] && [ $chosenMenuTwo != 4 ]
	do
		echo "Rossz megadas! Ujra!"
		read chosenMenuTwo
	done
	
	if [ $chosenMenuTwo == 1 ]
	then
		echo "Hany darab kerdest szeretne hozzaadni?"
		read iterator
		while [ $iterator -lt 1 ] || ! [ $iterator -eq $iterator 2>/dev/null ]
		do
			echo "Rossz megadas! Ujra!"
			read iterator
		done
		newQuestionCount=$questionCount
		for (( i=0; i<$iterator; i++))
		do
			echo ""
			echo "Irja le a kerdes szoveget majd nyomjon Enter-t!"
			read answer
			echo "$answer" >> $inputOne
			echo "Rendben! Most irja le a kerdesre adott helyes valaszt majd nyomjon Enter-t!"
			read answer
			echo "$answer" >> $inputTwo
			sed -i "1d" $inputThree
                	newQuestionCount=$((newQuestionCount+1))
                	echo "$newQuestionCount" >> $inputThree
		done
	elif [ $chosenMenuTwo == 2 ]
	then
		echo "Hany darab kerdest szeretne kitorolni?"
		read iterator
		while [ $iterator -gt $questionCount ] || [ $iterator -lt 1 ] || ! [ $iterator -eq $iterator 2>/dev/null ]
		do
			echo "Rossz megadas! Ujra!"
			read iterator
		done
		newQuestionCount=$questionCount
		for (( i=0; i<$iterator; i++))
		do
			echo ""
			if [ $i -gt 0 ]; then
				lineNumber=1
				while IFS= read -r linea; do
					echo "$lineNumber : $linea"
					lineNumber=$((lineNumber+1))
				done < "$inputOne"
			fi
			echo "Hanyas szamu kerdest szeretne kitorolni?"
			read answer
			while [ $answer -lt 1 ] || [ $answer -gt $newQuestionCount ] || ! [ $answer -eq $answer 2>/dev/null ]
			do
				echo "Rossz megadas! Ujra!"
				read answer
			done
			sed -i "${szoveg}d" $inputOne
			sed -i "${szoveg}d" $inputTwo
			sed -i "1d" $inputThree
			newQuestionCount=$((newQuestionCount-1))
			if [ $newQuestionCount -lt 0 ]; then
				sed -i "1d" $inputThree
				newQuestionCount=0
			fi
			echo "$newQuestionCount" >> $inputThree
		done
	elif [ $chosenMenuTwo == 3 ]
	then
		rm -r "prop/"
		mkdir prop
		touch prop/answerCount.txt
		touch prop/answers.txt
		touch prop/questions.txt
		echo "0" >> prop/answerCount.txt
	elif [ $chosenMenuTwo == 4 ]
	then
		exit 0
	fi


elif [ $chosenMenu == 3 ]
then
	exit 0
fi


